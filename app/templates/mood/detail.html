{% extends "base.html" %}
{% from datetime import timedelta %}

{% block title %}å¿ƒæƒ…è¯¦æƒ…{% endblock %}

{% block page_content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- è¿”å›æŒ‰é’® -->
    <div class="mb-6">
        <a href="{{ url_for('main.mood_history') }}"
           class="inline-flex items-center text-gray-600 hover:text-gray-800 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            è¿”å›å¿ƒæƒ…å†å²
        </a>
    </div>

    <!-- å¿ƒæƒ…è¯¦æƒ…å¡ç‰‡ -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-purple-100">
        <!-- å¤´éƒ¨ -->
        <div class="bg-gradient-to-r from-purple-100 via-pink-100 to-blue-100 p-8">
            <div class="text-center">
                <div class="text-6xl mb-4">
                    {% if mood.mood_type != 'custom' %}
                        {{ Mood.MOOD_CONFIG[mood.mood_type].icon }}
                    {% else %}
                        ğŸ’­
                    {% endif %}
                </div>
                <h1 class="text-3xl font-light text-gray-800 mb-2">
                    {% if mood.mood_type != 'custom' %}
                        {{ Mood.MOOD_CONFIG[mood.mood_type].label }}
                    {% else %}
                        {{ mood.custom_mood }}
                    {% endif %}
                </h1>
                <p class="text-gray-600">
                    {{ moment(mood.timestamp).format('YYYYå¹´MMæœˆDDæ—¥ HH:mm') }}
                </p>
            </div>
        </div>

        <!-- å†…å®¹ -->
        <div class="p-8">
            <!-- å¿ƒæƒ…å¼ºåº¦ -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-tachometer-alt text-purple-500 mr-2"></i>
                    å¿ƒæƒ…å¼ºåº¦
                </h3>
                <div class="flex items-center">
                    <div class="flex-1 max-w-md">
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-gradient-to-r from-blue-400 to-purple-400 h-4 rounded-full transition-all duration-500"
                                 style="width: {{ mood.intensity * 10 }}%"></div>
                        </div>
                    </div>
                    <span class="ml-4 text-2xl font-bold text-purple-600">{{ mood.intensity }}/10</span>
                </div>
                <p class="text-gray-500 text-sm mt-2">
                    {% if mood.intensity <= 3 %}
                        è½»å¾®çš„æƒ…ç»ªæ³¢åŠ¨
                    {% elif mood.intensity <= 6 %}
                        ä¸­ç­‰ç¨‹åº¦çš„æƒ…ç»ªä½“éªŒ
                    {% else %}
                        å¼ºçƒˆçš„æƒ…ç»ªæ„Ÿå—
                    {% endif %}
                </p>
            </div>

            <!-- æ—¥è®°å†…å®¹ -->
            {% if mood.diary %}
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-book text-blue-500 mr-2"></i>
                    ä»Šæ—¥æ—¥è®°
                </h3>
                <div class="bg-gray-50 rounded-xl p-6">
                    <div class="prose prose-sm max-w-none">
                        <p class="whitespace-pre-wrap leading-relaxed text-gray-700">{{ mood.diary }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- ç›¸å…³ä¿¡æ¯ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-blue-50 rounded-xl p-6">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                        è®°å½•ä¿¡æ¯
                    </h4>
                    <dl class="space-y-2 text-sm">
                        <div class="flex">
                            <dt class="text-gray-500 w-20">è®°å½•æ—¶é—´:</dt>
                            <dd class="text-gray-700">{{ moment(mood.timestamp).format('MM-DD HH:mm') }}</dd>
                        </div>
                        <div class="flex">
                            <dt class="text-gray-500 w-20">è®°å½•æ—¥æœŸ:</dt>
                            <dd class="text-gray-700">{{ mood.date }}</dd>
                        </div>
                    </dl>
                </div>

                <div class="bg-purple-50 rounded-xl p-6">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-lightbulb text-purple-500 mr-2"></i>
                        å¿ƒæƒ…å°è´´å£«
                    </h4>
                    <p class="text-sm text-gray-700">
                        {% if mood.mood_type == 'happy' %}
                            ä¿æŒè¿™ä»½æ„‰æ‚¦ï¼Œå¯ä»¥å°è¯•åˆ†äº«ç»™èº«è¾¹çš„äººï¼Œè®©å¿«ä¹åŠ å€ï¼
                        {% elif mood.mood_type == 'calm' %}
                            å¹³é™æ˜¯å†…å¿ƒçš„åŠ›é‡ï¼Œç»§ç»­ä¿æŒè¿™ç§å®é™çš„çŠ¶æ€ã€‚
                        {% elif mood.mood_type == 'anxious' %}
                            ç„¦è™‘æ—¶è¯•è¯•æ·±å‘¼å¸ï¼Œæˆ–è€…è¿›è¡Œä¸€äº›è½»æ¾çš„è¿åŠ¨æ¥ç¼“è§£å‹åŠ›ã€‚
                        {% elif mood.mood_type == 'sad' %}
                            å…è®¸è‡ªå·±æ„Ÿå—æ‚²ä¼¤ï¼Œè¿™ä¹Ÿæ˜¯æˆé•¿çš„ä¸€éƒ¨åˆ†ã€‚è®°å¾—å¯»æ±‚æ”¯æŒå’Œå…³çˆ±ã€‚
                        {% elif mood.mood_type == 'angry' %}
                            æ„¤æ€’æ˜¯æ­£å¸¸çš„æƒ…ç»ªï¼Œè¯•ç€æ‰¾åˆ°å¥åº·çš„æ–¹å¼æ¥è¡¨è¾¾å’Œé‡Šæ”¾å®ƒã€‚
                        {% else %}
                            æ¯ç§æƒ…ç»ªéƒ½æœ‰å®ƒçš„ä»·å€¼ï¼Œäº†è§£å¹¶æ¥çº³è‡ªå·±çš„æ„Ÿå—ã€‚
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex justify-center space-x-4">
                <a href="{{ url_for('main.mood_calendar', year=mood.date.year, month=mood.date.month) }}"
                   class="px-6 py-3 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors duration-300">
                    <i class="fas fa-calendar-alt mr-2"></i>
                    æŸ¥çœ‹æ—¥å†
                </a>
                <a href="{{ url_for('main.mood_history') }}"
                   class="px-6 py-3 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 transition-colors duration-300">
                    <i class="fas fa-history mr-2"></i>
                    æŸ¥çœ‹å†å²
                </a>
                <form action="{{ url_for('main.delete_mood', id=mood.id) }}" method="post"
                      onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å¿ƒæƒ…è®°å½•å—ï¼Ÿ')" class="inline">
                    <button type="submit"
                            class="px-6 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors duration-300">
                        <i class="fas fa-trash mr-2"></i>
                        åˆ é™¤è®°å½•
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ç›¸é‚»æ—¥æœŸå¯¼èˆª -->
    <div class="mt-8 flex justify-between">
        {% set prev_date = mood.date - timedelta(days=1) %}
        {% set next_date = mood.date + timedelta(days=1) %}

        <div class="flex-1">
            {% if prev_date >= (current_user.moods.order_by(Mood.date.asc()).first().date or mood.date) %}
            <a href="{{ url_for('main.mood_by_date', date_str=prev_date.isoformat()) }}"
               class="w-full md:w-auto px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-300 inline-flex items-center justify-center">
                <i class="fas fa-chevron-left mr-2"></i>
                å‰ä¸€å¤©
            </a>
            {% endif %}
        </div>

        <div class="flex-1 text-right">
            {% if next_date <= mood.date.today() %}
            <a href="{{ url_for('main.mood_by_date', date_str=next_date.isoformat()) }}"
               class="w-full md:w-auto px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-300 inline-flex items-center justify-center">
                åä¸€å¤©
                <i class="fas fa-chevron-right ml-2"></i>
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // æ·»åŠ è¿›å…¥åŠ¨ç”»
    const card = document.querySelector('.bg-white.rounded-2xl');
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';

    setTimeout(() => {
        card.style.transition = 'all 0.6s ease-out';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
    }, 100);
});
</script>
{% endblock %}